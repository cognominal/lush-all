{"version":3,"file":"_server.ts-B8v-s1k1.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/auth/callback/_server.ts.js"],"sourcesContent":["import { W as WORKOS_OAUTH_STATE_COOKIE, a as WORKOS_PKCE_VERIFIER_COOKIE, w as workos, b as workosCookiePassword, c as workosClientId, d as cookieSecureFor, e as WORKOS_SESSION_COOKIE, f as WORKOS_RETURN_TO_COOKIE } from \"../../../../chunks/workos.js\";\nimport { error, redirect } from \"@sveltejs/kit\";\nconst SESSION_COOKIE_MAX_AGE_SECONDS = 30 * 24 * 60 * 60;\nconst GET = async (event) => {\n  const { url, cookies, request } = event;\n  const code = url.searchParams.get(\"code\");\n  const state = url.searchParams.get(\"state\");\n  if (!code) throw error(400, \"Missing `code`\");\n  if (!state) throw error(400, \"Missing `state`\");\n  const expectedState = cookies.get(WORKOS_OAUTH_STATE_COOKIE);\n  if (!expectedState || expectedState !== state) throw error(400, \"Invalid OAuth state\");\n  const codeVerifier = cookies.get(WORKOS_PKCE_VERIFIER_COOKIE);\n  if (!codeVerifier) throw error(400, \"Missing PKCE verifier\");\n  const userAgent = request.headers.get(\"user-agent\") ?? void 0;\n  const ipAddress = event.getClientAddress?.();\n  const auth = await workos().userManagement.authenticateWithCode({\n    clientId: workosClientId(),\n    code,\n    codeVerifier,\n    ipAddress,\n    userAgent,\n    session: {\n      sealSession: true,\n      cookiePassword: workosCookiePassword()\n    }\n  });\n  if (!auth.sealedSession) throw error(500, \"Missing sealed session\");\n  const secure = cookieSecureFor(url);\n  cookies.set(WORKOS_SESSION_COOKIE, auth.sealedSession, {\n    httpOnly: true,\n    sameSite: \"lax\",\n    path: \"/\",\n    secure,\n    maxAge: SESSION_COOKIE_MAX_AGE_SECONDS\n  });\n  cookies.delete(WORKOS_OAUTH_STATE_COOKIE, { path: \"/\", secure });\n  cookies.delete(WORKOS_PKCE_VERIFIER_COOKIE, { path: \"/\", secure });\n  const returnTo = cookies.get(WORKOS_RETURN_TO_COOKIE);\n  if (returnTo) cookies.delete(WORKOS_RETURN_TO_COOKIE, { path: \"/\", secure });\n  throw redirect(302, returnTo ?? \"/\");\n};\nexport {\n  GET\n};\n"],"names":[],"mappings":";;;;;;AAEA,MAAM,8BAA8B,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE;AACnD,MAAC,GAAG,GAAG,OAAO,KAAK,KAAK;AAC7B,EAAE,MAAM,EAAE,GAAG,EAAE,OAAO,EAAE,OAAO,EAAE,GAAG,KAAK;AACzC,EAAE,MAAM,IAAI,GAAG,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,MAAM,CAAC;AAC3C,EAAE,MAAM,KAAK,GAAG,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,OAAO,CAAC;AAC7C,EAAE,IAAI,CAAC,IAAI,EAAE,MAAM,KAAK,CAAC,GAAG,EAAE,gBAAgB,CAAC;AAC/C,EAAE,IAAI,CAAC,KAAK,EAAE,MAAM,KAAK,CAAC,GAAG,EAAE,iBAAiB,CAAC;AACjD,EAAE,MAAM,aAAa,GAAG,OAAO,CAAC,GAAG,CAAC,yBAAyB,CAAC;AAC9D,EAAE,IAAI,CAAC,aAAa,IAAI,aAAa,KAAK,KAAK,EAAE,MAAM,KAAK,CAAC,GAAG,EAAE,qBAAqB,CAAC;AACxF,EAAE,MAAM,YAAY,GAAG,OAAO,CAAC,GAAG,CAAC,2BAA2B,CAAC;AAC/D,EAAE,IAAI,CAAC,YAAY,EAAE,MAAM,KAAK,CAAC,GAAG,EAAE,uBAAuB,CAAC;AAC9D,EAAE,MAAM,SAAS,GAAG,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,YAAY,CAAC,IAAI,MAAM;AAC/D,EAAE,MAAM,SAAS,GAAG,KAAK,CAAC,gBAAgB,IAAI;AAC9C,EAAE,MAAM,IAAI,GAAG,MAAM,MAAM,EAAE,CAAC,cAAc,CAAC,oBAAoB,CAAC;AAClE,IAAI,QAAQ,EAAE,cAAc,EAAE;AAC9B,IAAI,IAAI;AACR,IAAI,YAAY;AAChB,IAAI,SAAS;AACb,IAAI,SAAS;AACb,IAAI,OAAO,EAAE;AACb,MAAM,WAAW,EAAE,IAAI;AACvB,MAAM,cAAc,EAAE,oBAAoB;AAC1C;AACA,GAAG,CAAC;AACJ,EAAE,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,MAAM,KAAK,CAAC,GAAG,EAAE,wBAAwB,CAAC;AACrE,EAAE,MAAM,MAAM,GAAG,eAAe,CAAC,GAAG,CAAC;AACrC,EAAE,OAAO,CAAC,GAAG,CAAC,qBAAqB,EAAE,IAAI,CAAC,aAAa,EAAE;AACzD,IAAI,QAAQ,EAAE,IAAI;AAClB,IAAI,QAAQ,EAAE,KAAK;AACnB,IAAI,IAAI,EAAE,GAAG;AACb,IAAI,MAAM;AACV,IAAI,MAAM,EAAE;AACZ,GAAG,CAAC;AACJ,EAAE,OAAO,CAAC,MAAM,CAAC,yBAAyB,EAAE,EAAE,IAAI,EAAE,GAAG,EAAE,MAAM,EAAE,CAAC;AAClE,EAAE,OAAO,CAAC,MAAM,CAAC,2BAA2B,EAAE,EAAE,IAAI,EAAE,GAAG,EAAE,MAAM,EAAE,CAAC;AACpE,EAAE,MAAM,QAAQ,GAAG,OAAO,CAAC,GAAG,CAAC,uBAAuB,CAAC;AACvD,EAAE,IAAI,QAAQ,EAAE,OAAO,CAAC,MAAM,CAAC,uBAAuB,EAAE,EAAE,IAAI,EAAE,GAAG,EAAE,MAAM,EAAE,CAAC;AAC9E,EAAE,MAAM,QAAQ,CAAC,GAAG,EAAE,QAAQ,IAAI,GAAG,CAAC;AACtC;;;;"}